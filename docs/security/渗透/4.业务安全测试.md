---
# 这是页面的图标
icon: file
# 这是文章的标题
title: 业务安全测试
# 设置作者
author: lhz
# 设置写作时间
time: 2021-08-20
# 一个页面只能有一个分类
category: 渗透
# 一个页面可以有多个标签
tag:
  - 业务安全
comment: false
typora-root-url: ..\..\..\.vuepress\public
---



### 1. 业务安全测试

1分钱支付，购物车零元支付，身份变更

### 2. 登录认证模块测试
#### 暴力破解

1. 当系统存在登录功能，并且没有做好对应的防护措施时。
2. 测试 工具: Burp Suite
3. 防御方法：
    1. 增加验证码：登录失败一次，验证码变换一次
    2. 配置登录失败次数限制策略
    3. 条件允许下：增加收集短信或邮箱验证码，双因素验证


#### Cookie仿冒测试


1. 通过修改Cookie中的身份，从而达到仿冒其他用户身份目的，并拥有相关用户的权限
2. 案例
    1. 通过篡改Cookie认证会话值成功转变身份
1. 测试方法
    1. 获取已授权的用户身份的Cookie会话值
    2. 篡改已授权用户Cookie值，成功转换身份
1. 防御方法
    1. 对身份标识及敏感信息数据使用更为安全的Session会话认证方式存储，避免被其他人利用

#### 密文对比认证测试

1. 认证密码提交到服务器，服务器进行加密后在数据库检查是否正确
2. 如果在客户端对密码进行加密，会暴露密码加密算法
3. 测试方法：
    1. 分析客户端密码加密方法
    2. 在burpsuite中配置对应加密方法，进行暴力破解
1. 防御方案
    1. 将密码加密过程及密文对比过程放置在服务器后台执行
    2. 对用户登录添加有效的验证码机制
    3. 对密码加密数据进行加盐处理存储

#### 登录失败信息测试

1. 案例：登录失败时提示错误信息：“用户名不存在”，“账号不存在”，“密码错误”
2. 测试方法：

    根据返回信息不同，先进行账号是否存在猜测。
1. 防御方法：

    对登录失败返回信息进行统一的模糊处理，提高用户名及密码猜测难度。
	
### 3. 业务办理模块测试
#### 竞争条件测试

1.  竞争条件漏洞原理：
    1.  当多个进程或线程在读写一个共享数据时，结果依赖于它们执行的相对时间的情形。
    2.  在web中，当多个进程对同一数据库进行读写时，可能会由于时序问题，造成一些逻辑错误的异常情况。
2.  场景：
    1.  超卖问题：卖出数量大于库存数量
    2.  支付逻辑：在余额数据更新之前，多次购买，兑换产品
    3.  文件上传：在服务器判断删除webshell操作，之前访问脚本
3.  漏洞修复
    1.  使用事务，保证逻辑正确
    2.  使用select…for update数据库实现悲观锁

### 4. 业务授权访问模块测试
#### 越权漏洞
水平越权、垂直越权
1. 测试方法：
    1. 水平越权：修改访问数据中的身份标识，测试是否能访问其他人的数据
    2. 垂直越权：在注册或修改密码时抓取数据，修改身份标识，获取管理员密码
2. 防御方法
    1. 关键操作前进行身份鉴别
    2. 关键顺序操作每一步都要进行身份鉴别
    
### 5. 输入输出模块
#### SQL注入

1. 类型：字符型，数字型
2. 手工测试：
    1. 发现注入点
    2. 数据表列数测试： order by 1
    3. 显示点测试：select 1,2,3
    4. 获取库名，列名
    5. 获取数据
3. 防御：
    1. sql关键字过滤
    2. sql语句特殊符号过滤，转义
    3. 使用传参方式进行数据库查询操作

#### XSS注入
```JavaScript
<script>alert(1)</script>
<scrip<script>t>alert(1)</script>
<Script>alert(1)</script>
<img src=1 onerror=alert(1)>
&#x003c;img src=1 onerror=alert(document.cookie)&#x003e;
```

1. 防御：
    1. 完善输入输出检查，过滤其中包含的特殊字符，或转义
    2. 信息搜索功能不应在搜索结果回显搜索内容
    3. 设置出错页面，防止出错时内部信息返回给客户端
2. 命令执行
### 6. 验证码机制模块

#### 验证码暴力破解

1. 通过暴力破解短信验证码实现重置任意用户密码。
2. 测试方法
    1. 接受验证码，观察验证码是否有规律。
    2. 多次填写验证码提交，观察是否有时效性或次数限制。
    3. 通过工具暴力猜解验证码。
1. 测试工具：burpsuite
2. 防御
    1. 提高验证码复杂度。
    2. 设置单位时间内验证码输入错误的次数。
    3. 缩短验证码的时效。


#### 验证码客户端回显测试

1. 验证码客户端向网站系统发送一条验证码的请求时，验证码会直接返回显示在前端页面中，或者可通过抓包工具截获该验证码。
2. 原理：把验证码校验的功能放到客户端进行。
3. 测试方法
    1. 数据任意手机号，点击发送验证码并抓取数据包。
    2. 查看返回数据包，观察验证码是否回显。
1. 防御方案：
    1. 在服务端对验证码进行校验。
    2. 禁止验证码回显到客户端。

#### 验证码绕过测试

1. 原理：在本地进行验证码校验。
2. 测试方法
    1. 接收验证码后，输入任意验证码，并提交抓包。
    2. 尝试修改返回包中相关的参数值。
    3. 转发数据包，观察是否绕过成功。

#### 验证码自动识别

1. 一般识别流程：图像去二值话->去干扰->字符分割->字符识别
2. 一般识别率达到70%就判断存在高风险。
3. 工具：burpsuite， Pkav http fuzzer
4. 防御方案：
    1. 增加验证码背景元素干扰。
    2. 字符字体扭曲，粘连。
    3. 使用公式、逻辑验证等方法作为验证码。如四则运算，问答题等。
    4. 图形验证码和使用者相关，如选择联系人头像，购买过的物品等。
    5. 对单位内提交请求失败次数进行限制。

#### 验证码重复使用测试

1. 重复使用验证码，用于暴力破解等攻击。
2. 测试方法：
    1. burpsuite抓取登录包。
    2. 重放登录包，未提示验证码异常则存在烟瘴吗重复使用漏洞。
    
### 7. 支付漏洞

#### 业务篡改测试

1. 支付逻辑漏洞。
2. 危害：数据篡改、低价购买、反复订购、刷单刷库存……
3. 测试：
    1. 抓包获取请求中的商品金额、商品数量、折扣等字段
    2. 修改字段并提交
    3. 观察支付流程是否继续完成
1. 防御方案：
    1. 只从客户端获取商品id和数量。
    2. 对数量范围进行限制。
    3. 对支付金额和订单金额进行对比以及加入签名验证避免关键字段篡改。

#### 业务数据重放
1. 一次支付，多次收货
2. 防御方案：
    1. 尽量少的支付请求。
    2. 对于多次出现同一订购要求，直接要求重新下单不让支付。
    3. 每次生成新的交易流水号。
### 8. 密码找回漏洞

#### 暴力破解用户凭证

1. 利用密码找回漏洞重置其他用户密码，盗取账号，冒用他人身份。
2. 在找回密码时，对用户凭证进行暴力破解。
3. 防御：
    1. 对用户凭证验证次数和频率进行限制，防止暴力枚举攻击。


#### 密码找回漏洞

#### 服务端验证逻辑缺陷

1. 测试方法案例：
    1. 删除验证参数绕过。
    2. 修改验证邮箱参数。
    3. 直接访问修改密码链接。

#### 注册覆盖和session覆盖

1. 通过重复注册已存在的账户，或者在同一个浏览器中打开不同用户的多个密码找回页面，利用session覆盖等方式成功重置其他人的密码。
2. 测试方法：
    1. 利用自己的账号A进行密码找回，收到邮件后先不访问密码重置连接。
    2. 紧接着在同浏览器内打开网站再次进行密码找回页面，输入其他人的账号B，点击发送密码邮件后停在该页面。
    3. 在同一浏览器中打开第1步中自己邮件收到的连接，重置一个新密码。
    4. 观察是否能用心设置的密码成功登陆账号B。
### 9. 业务接口测试

#### 业务接口未授权访问测试

1. 开发人员在进行接口开发的时候，对接口调用者的身份缺少认证，导致攻击者可以在未进行身份权限认证的情况下获取敏感数据信息。
2. 通过burpsuite观察接口返回信息是否存在敏感信息，存在敏感信息则存在接口未授权漏洞。

#### Callback自定义测试

1. 接口开发时，在接受回调函数的参数值，在进行拼接前没有对恶意数据进行合理的精华，导致攻击者恶意插入的html标签在返回的json数据格式原样输出。导致返回的json数据被浏览器当做html内容进行解析，造成了xss等漏洞的出现。
2. 测试：
    1. 在burpsuite中httphistory中寻找callback、jsonp、cb=关键字请求。
    2. 观察请求响应的Content-type是否为text/html，且内容是否为jsonp形式。
    3. 如果符合要求，则修改回调参数为xxx<h1>1</h1>，观察响应中是否为html是否被转义。如果没有，则存在Callback自定义测试漏洞。

#### WebService测试

1. WebService是一种以XML作为数据交换格式的应用接口，开发者能够以HTTP请求的方式来调用WebService执行不同的功能，这些功能可能影响着数据库、文件等：WebService SQL注入测试、WebService XML外部实体攻击测试、WebService XPATH注入测试
2. AWVS（Acunetix Web Vulnerability Scanner）
3. Url后添加?wsdl参数

### 10. 越权漏洞

#### 水平越权

1. 修改请求数据包中代表用户ID相关参数值，判断是否可以获取其他用户信息。

#### 垂直越权

1. 在没有任何权限的情况下添加管理员用户，获得管理员权限。
2. 测试方法：
    1. 在添加用户处抓取请求数据包，生成form表单，设置账号密码，越权添加管理员用户。